<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>íšŒì›ê°€ì…</title>
  <style>
    :root { --bg:#f7f7f8; --card:#fff; --text:#111; --muted:#666; --line:#e6e6e6; --primary:#111; --error:#d33; --ok:#0a7f42; }
    * { box-sizing: border-box; }
    body { margin:0; background:var(--bg); font:16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, 'Noto Sans KR', sans-serif; color:var(--text); }
    header { padding:16px; border-bottom:1px solid var(--line); background:#fff; }
    .brand { font-weight:800; font-size:22px; text-decoration:none; color:var(--text); }
    .page { max-width:520px; margin:32px auto; padding:0 16px; }
    .card { background:var(--card); border:1px solid var(--line); border-radius:18px; padding:28px; box-shadow:0 1px 10px rgba(0,0,0,.04); }
    .head { text-align:center; margin-bottom:20px; }
    .avatar { width:80px; height:80px; margin:0 auto 12px; border-radius:50%; display:grid; place-items:center; background:#eee; color:#888; font-size:42px; }
    .title { font-size:22px; font-weight:700; }
    label { display:block; font-size:13px; color:var(--muted); margin:14px 2px 6px; }
    input { width:100%; padding:12px 14px; border:1px solid var(--line); border-radius:12px; outline:none; background:#fff; }
    input:focus { border-color:#bbb; box-shadow:0 0 0 3px rgba(0,0,0,.06); }
    .row { margin-bottom:4px; }
    .hint { font-size:12px; color:var(--muted); margin-top:6px; }
    .err { font-size:13px; color:var(--error); margin-top:6px; display:none; }
    .btn { width:100%; margin-top:18px; padding:13px 16px; border:0; border-radius:12px; background:var(--primary); color:#fff; font-weight:600; cursor:pointer; }
    .btn[disabled] { opacity:.6; cursor:default; }
    .msg { margin-top:14px; font-size:14px; }
    .msg.ok { color:var(--ok); }
    .msg.bad { color:var(--error); white-space:pre-line; }
    .tos { display:flex; gap:8px; align-items:center; font-size:13px; color:var(--muted); margin-top:8px; }
  </style>
</head>
<body>
  <header>
    <a class="brand" href="main.html">Kolon</a>
  </header>

  <div class="page">
    <div class="card">
      <div class="head">
        <div class="avatar">ğŸ‘¤</div>
        <div class="title">íšŒì›ê°€ì…</div>
      </div>

      <form id="form" novalidate>
        <div class="row">
          <label for="email">ì•„ì´ë””(ì´ë©”ì¼)</label>
          <input id="email" name="email" type="email" autocomplete="email" required />
          <div class="err" id="e_email"></div>
        </div>

        <div class="row">
          <label for="pw">ë¹„ë°€ë²ˆí˜¸</label>
          <input id="pw" name="password" type="password" autocomplete="new-password" minlength="8" required />
          <div class="hint">ìµœì†Œ 8ì, ì˜ë¬¸/ìˆ«ì ì¡°í•© ê¶Œì¥</div>
          <div class="err" id="e_pw"></div>
        </div>

        <div class="row">
          <label for="pw2">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
          <input id="pw2" name="password2" type="password" autocomplete="new-password" required />
          <div class="err" id="e_pw2"></div>
        </div>

        <div class="row">
          <label for="name">ì´ë¦„</label>
          <input id="name" name="name" type="text" autocomplete="name" required />
          <div class="err" id="e_name"></div>
        </div>

        <div class="row">
          <label for="phone">íœ´ëŒ€í°ë²ˆí˜¸</label>
          <input id="phone" name="phone" type="tel" placeholder="010-1234-5678" autocomplete="tel" required />
          <div class="err" id="e_phone"></div>
        </div>

        <button class="btn" id="submitBtn" type="submit">ë™ì˜í•˜ê³  ê°€ì…í•˜ê¸°</button>
        <div id="msg" class="msg"></div>
      </form>
    </div>
  </div>

  <script>
    const API_BASE = "";                 // ì„œë²„ ë¶™ì´ë©´ ê°’ ì„¤ì •
    const INITIAL_POINTS = 100000;       // ì´ˆê¸° í¬ì¸íŠ¸
    const PROFILE_KEY = 'user_profile';  // {name, phone, address}
    const POINT_KEY = 'points';
    const USERS_KEY = 'users';           // { [email]: { pass: <sha256>, name, phone, address } }

    const $ = s => document.querySelector(s);
    const emailRe = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    const phoneRe = /^01[016789]-?\d{3,4}-?\d{4}$/;

    function showErr(id, msg){ const el=$('#e_'+id); if(el){ el.textContent=msg||''; el.style.display=msg?'block':'none'; } }
    function validate(v){
      let ok=true; showErr("email",""); showErr("pw",""); showErr("pw2",""); showErr("name",""); showErr("phone","");
      if(!emailRe.test(v.email)){ showErr("email","ì´ë©”ì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."); ok=false; }
      if(!v.password || v.password.length<8){ showErr("pw","ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤."); ok=false; }
      if(v.password!==v.password2){ showErr("pw2","ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."); ok=false; }
      if(!v.name.trim()){ showErr("name","ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”."); ok=false; }
      if(!phoneRe.test(v.phone)){ showErr("phone","íœ´ëŒ€í° ë²ˆí˜¸ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."); ok=false; }
      if(!$('#agree').checked){ alert('ì•½ê´€ì— ë™ì˜í•´ ì£¼ì„¸ìš”.'); ok=false; }
      return ok;
    }

    async function sha256(text){
      const enc = new TextEncoder().encode(text);
      const buf = await crypto.subtle.digest('SHA-256', enc);
      return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
    }
    const readUsers = ()=> { try{return JSON.parse(localStorage.getItem(USERS_KEY))||{}}catch{ return {} } };
    const writeUsers = (u)=> localStorage.setItem(USERS_KEY, JSON.stringify(u));

    $('#form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const btn=$('#submitBtn'), msg=$('#msg'); msg.className='msg'; msg.textContent="";
      const v={
        email:$('#email').value.trim(),
        password:$('#pw').value,
        password2:$('#pw2').value,
        name:$('#name').value.trim(),
        phone:$('#phone').value.trim(),
        addr:$('#addr').value.trim()
      };
      if(!validate(v)) return;

      btn.disabled=true; msg.textContent="ì „ì†¡ ì¤‘...";

      if(API_BASE){
        try{
          const res=await fetch(API_BASE+"/api/auth/register",{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({email:v.email,password:v.password,name:v.name,phone:v.phone,address:v.addr}),
            credentials:"include"
          });
          if(res.status===409){ msg.className='msg bad'; msg.textContent="ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤."; btn.disabled=false; return; }
          if(!res.ok){ let data={}; try{data=await res.json()}catch{}; msg.className='msg bad'; msg.textContent=data.msg||`ê°€ì… ì‹¤íŒ¨ (HTTP ${res.status})`; btn.disabled=false; return; }

          // ì„œë²„ ëª¨ë“œ: í¬ì¸íŠ¸/ë¹„ë°€ë²ˆí˜¸ëŠ” ì„œë²„ì—ì„œ ì²˜ë¦¬
          localStorage.setItem(PROFILE_KEY, JSON.stringify({name:v.name, phone:v.phone, address:v.addr}));
          localStorage.setItem('lastSignedUpEmail', v.email);
          msg.className='msg ok'; msg.textContent="ê°€ì… ì™„ë£Œ ğŸ‰ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤...";
          setTimeout(()=>location.href='login.html',700);
          return;
        }catch(err){
          msg.className='msg bad'; msg.textContent="ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: "+(err?.message||"ìš”ì²­ ì‹¤íŒ¨"); btn.disabled=false; return;
        }
      }

      // === Mock ëª¨ë“œ ===
      await new Promise(r=>setTimeout(r,300));

      if(localStorage.getItem(POINT_KEY)===null){
        localStorage.setItem(POINT_KEY, String(INITIAL_POINTS));
      }

      const users = readUsers();
      users[v.email] = {
        pass: await sha256(v.password),
        name: v.name,
        phone: v.phone,
        address: v.addr
      };
      writeUsers(users);

      localStorage.setItem(PROFILE_KEY, JSON.stringify({name:v.name, phone:v.phone, address:v.addr}));
      localStorage.setItem('lastSignedUpEmail', v.email);

      msg.className='msg ok'; msg.textContent="ê°€ì… ì™„ë£Œ ğŸ‰ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤...";
      setTimeout(()=>location.href='login.html',700);
    });
  </script>
</body>
</html>

  <script>
    // ===== ì„¤ì • =====
    const API_BASE = "";                 // API ë¶™ì´ë©´ ê°’ ì„¸íŒ…
    const INITIAL_POINTS = 100000;       // âœ… ì´ˆê¸° í¬ì¸íŠ¸ (10,000 â†’ 100,000)
    const PROFILE_KEY = 'user_profile';  // {name, phone, address}
    const POINT_KEY = 'points';

    // ===== ìœ íš¨ì„± =====
    const $ = s => document.querySelector(s);
    const emailRe = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    const phoneRe = /^01[016789]-?\d{3,4}-?\d{4}$/;

    function showErr(id, msg){ const el=$('#e_'+id); if(el){ el.textContent=msg||''; el.style.display=msg?'block':'none'; } }
    function validate(v){
      let ok=true; showErr("email",""); showErr("pw",""); showErr("pw2",""); showErr("name",""); showErr("phone","");
      if(!emailRe.test(v.email)){ showErr("email","ì´ë©”ì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."); ok=false; }
      if(!v.password || v.password.length<8){ showErr("pw","ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤."); ok=false; }
      if(v.password!==v.password2){ showErr("pw2","ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."); ok=false; }
      if(!v.name.trim()){ showErr("name","ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”."); ok=false; }
      if(!phoneRe.test(v.phone)){ showErr("phone","íœ´ëŒ€í° ë²ˆí˜¸ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."); ok=false; }
      if(!$('#agree').checked){ alert('ì•½ê´€ì— ë™ì˜í•´ ì£¼ì„¸ìš”.'); ok=false; }
      return ok;
    }

    // ===== ì œì¶œ =====
    $('#form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const btn=$('#submitBtn'), msg=$('#msg'); msg.className='msg'; msg.textContent="";

      const v={
        email:$('#email').value.trim(),
        password:$('#pw').value,
        password2:$('#pw2').value,
        name:$('#name').value.trim(),
        phone:$('#phone').value.trim(),
        addr:$('#addr').value.trim()
      };
      if(!validate(v)) return;

      btn.disabled=true; msg.textContent="ì „ì†¡ ì¤‘...";

      // ì„œë²„ ì—°ê²° ëª¨ë“œ
      if(API_BASE){
        try{
          const res=await fetch(API_BASE+"/api/auth/register",{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({email:v.email,password:v.password,name:v.name,phone:v.phone,address:v.addr}),
            credentials:"include"
          });

          if(res.status===409){ msg.className='msg bad'; msg.textContent="ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤."; btn.disabled=false; return; }
          if(!res.ok){
            let data={}; try{ data=await res.json(); }catch{}
            msg.className='msg bad'; msg.textContent=data.msg||`ê°€ì… ì‹¤íŒ¨ (HTTP ${res.status})`; btn.disabled=false; return;
          }

          // âš ï¸ ì‹¤ì œ ìš´ì˜ì—ì„  ì„œë²„ê°€ 100,000Pë¥¼ 'ê°€ì… íŠ¸ëœì­ì…˜'ì—ì„œ 1íšŒ ì§€ê¸‰í•˜ì„¸ìš”.
          // í”„ëŸ°íŠ¸ì—ì„  ì¤‘ë³µ ì§€ê¸‰ ë°©ì§€ë¥¼ ìœ„í•´ í¬ì¸íŠ¸ë¥¼ ì„¸íŒ…í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

          // ê²°ì œì— ì‚¬ìš©í•  í”„ë¡œí•„ ì €ì¥(ì„ íƒ)
          localStorage.setItem(PROFILE_KEY, JSON.stringify({name:v.name, phone:v.phone, address:v.addr}));

          msg.className='msg ok'; msg.textContent="ê°€ì… ì™„ë£Œ ğŸ‰ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤...";
          setTimeout(()=>location.href='login.html',700);
          return;

        }catch(err){
          msg.className='msg bad'; msg.textContent="ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: "+(err?.message||"ìš”ì²­ ì‹¤íŒ¨"); btn.disabled=false; return;
        }
      }

      // ===== Mock ëª¨ë“œ (API_BASE ë¹„ì–´ìˆìŒ) =====
      await new Promise(r=>setTimeout(r,400));

      // âœ… ì´ˆê¸° í¬ì¸íŠ¸ 100,000P 1íšŒ ì§€ê¸‰
      if(localStorage.getItem(POINT_KEY)===null){
        localStorage.setItem(POINT_KEY, String(INITIAL_POINTS));
      }

      // ê²°ì œìš© í”„ë¡œí•„ ì €ì¥
      localStorage.setItem(PROFILE_KEY, JSON.stringify({name:v.name, phone:v.phone, address:v.addr}));

      msg.className='msg ok';
      msg.textContent="ê°€ì… ì™„ë£Œ ğŸ‰ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤...";
      setTimeout(()=>location.href='login.html',700);
    });
  </script>
</body>
</html>

